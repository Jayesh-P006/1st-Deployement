{% extends 'base.html' %}

{% block title %}Training Data Management{% endblock %}

{% block content %}
<div style="margin-bottom: 20px;">
  <h1 style="margin-bottom: 10px;">ğŸ“ Training Data Management</h1>
  <p style="color: #666;">Manage information used to train AI responses for auto-replies</p>
</div>

<div style="display: flex; gap: 20px; margin-bottom: 25px;">
  <a href="{{ url_for('training.new_data') }}" class="btn" style="background: #28a745; color: #fff;">
    <span style="font-size: 18px;">+</span> Add New Data
  </a>
  
  <div style="display: flex; gap: 10px; flex-wrap: wrap;">
    <a href="{{ url_for('training.index', category='all') }}" 
       class="btn secondary {% if category_filter == 'all' %}active{% endif %}"
       style="{% if category_filter == 'all' %}background: #0a66c2; color: #fff;{% endif %}">
      All ({{ categories.all }})
    </a>
    <a href="{{ url_for('training.index', category='event') }}" 
       class="btn secondary {% if category_filter == 'event' %}active{% endif %}"
       style="{% if category_filter == 'event' %}background: #0a66c2; color: #fff;{% endif %}">
      ğŸ“… Events ({{ categories.event }})
    </a>
    <a href="{{ url_for('training.index', category='community') }}" 
       class="btn secondary {% if category_filter == 'community' %}active{% endif %}"
       style="{% if category_filter == 'community' %}background: #0a66c2; color: #fff;{% endif %}">
      ğŸ‘¥ Community ({{ categories.community }})
    </a>
    <a href="{{ url_for('training.index', category='faq') }}" 
       class="btn secondary {% if category_filter == 'faq' %}active{% endif %}"
       style="{% if category_filter == 'faq' %}background: #0a66c2; color: #fff;{% endif %}">
      â“ FAQ ({{ categories.faq }})
    </a>
    <a href="{{ url_for('training.index', category='product') }}" 
       class="btn secondary {% if category_filter == 'product' %}active{% endif %}"
       style="{% if category_filter == 'product' %}background: #0a66c2; color: #fff;{% endif %}">
      ğŸ“¦ Product ({{ categories.product }})
    </a>
    <a href="{{ url_for('training.index', category='other') }}" 
       class="btn secondary {% if category_filter == 'other' %}active{% endif %}"
       style="{% if category_filter == 'other' %}background: #0a66c2; color: #fff;{% endif %}">
      ğŸ“‹ Other ({{ categories.other }})
    </a>
  </div>
</div>

{% if training_data %}
<div style="display: grid; gap: 20px;">
  {% for data in training_data %}
  <div class="card" style="border-left: 4px solid {% if data.is_active %}#28a745{% else %}#ccc{% endif %};">
    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
      <div style="flex: 1;">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 8px;">
          <span class="badge" style="background: #0a66c2; color: white;">{{ data.category }}</span>
          <span class="badge" style="background: #f59e0b; color: white;">Priority: {{ data.priority }}</span>
          {% if not data.is_active %}
          <span class="badge" style="background: #6c757d; color: white;">Inactive</span>
          {% endif %}
        </div>
        <h3 style="margin: 0 0 10px 0; color: #1a1a1a;">{{ data.title }}</h3>
        <p style="color: #666; margin: 0 0 10px 0;">{{ data.content[:200] }}{% if data.content|length > 200 %}...{% endif %}</p>
        
        {% if data.event_date or data.location %}
        <div style="display: flex; gap: 15px; margin-top: 10px; font-size: 14px; color: #666;">
          {% if data.event_date %}
          <span>ğŸ“… {{ data.event_date.strftime('%Y-%m-%d %H:%M') }}</span>
          {% endif %}
          {% if data.location %}
          <span>ğŸ“ {{ data.location }}</span>
          {% endif %}
        </div>
        {% endif %}
        
        {% if data.tags %}
        <div style="margin-top: 10px;">
          {% set tag_list = data.tags|from_json %}
          {% for tag in tag_list %}
          <span class="badge" style="background: #e9ecef; color: #495057; margin-right: 5px;">#{{ tag }}</span>
          {% endfor %}
        </div>
        {% endif %}
        
        <div style="margin-top: 10px; font-size: 13px; color: #999;">
          Created by: {{ data.creator.full_name or data.creator.username if data.creator else 'Unknown' }} | 
          {{ data.created_at.strftime('%Y-%m-%d') }}
        </div>
      </div>
      
      <div style="display: flex; gap: 8px; margin-left: 20px;">
        <a href="{{ url_for('training.edit_data', data_id=data.id) }}" class="btn secondary" style="padding: 8px 15px;">
          âœï¸ Edit
        </a>
        <form method="POST" action="{{ url_for('training.toggle_active', data_id=data.id) }}" style="display: inline;">
          <button type="submit" class="btn secondary" style="padding: 8px 15px;">
            {% if data.is_active %}â¸ï¸ Deactivate{% else %}â–¶ï¸ Activate{% endif %}
          </button>
        </form>
        <form method="POST" action="{{ url_for('training.delete_data', data_id=data.id) }}" 
              onsubmit="return confirm('Delete this training data?')" style="display: inline;">
          <button type="submit" class="btn danger" style="padding: 8px 15px;">ğŸ—‘ï¸ Delete</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="card" style="text-align: center; padding: 60px 20px;">
  <h2 style="color: #999; margin-bottom: 10px;">No training data found</h2>
  <p style="color: #999; margin-bottom: 20px;">Add information to help the AI generate better responses</p>
  <a href="{{ url_for('training.new_data') }}" class="btn" style="background: #28a745; color: #fff;">
    <span style="font-size: 18px;">+</span> Add First Data
  </a>
</div>
{% endif %}
{% endblock %}
