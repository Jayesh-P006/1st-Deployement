{% extends 'base.html' %}
{% block title %}Auto-Comment Reply{% endblock %}

{% block head %}
<style>
/* ================= ROOT THEME ================= */
:root {
    --bg-main: #f8fafc;
    --card-bg: rgba(255, 255, 255, 0.85);
    --border-soft: rgba(0, 0, 0, 0.06);

    --text-primary: #0f172a;
    --text-secondary: #64748b;

    --primary: #7c3aed;        /* Same family as New Draft button */
    --primary-soft: #ede9fe;
    --success: #10b981;
    --danger: #ef4444;

    --radius-lg: 20px;
    --radius-md: 14px;
    --radius-sm: 10px;

    --shadow-soft: 0 10px 30px rgba(216, 193, 240, 0.897);
    --shadow-hover: 0 16px 45px  rgba(190, 153, 229, 0.897);
}

/* ================= PAGE ================= */
.auto-comment-container {
    max-width: 1200px;
    margin: auto;
    padding: 40px 24px;
    background: var(--bg-main);
}

/* ================= HEADER ================= */
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
}

.page-header h1 {
    font-size: 30px;
    font-weight: 800;
    color: var(--text-primary);
    letter-spacing: -0.5px;
}

/* Back Button */
.back-link {
    padding: 10px 18px;
    background: var(--card-bg);
    border-radius: var(--radius-sm);
    border: 1px solid var(--border-soft);
    text-decoration: none;
    font-weight: 600;
    color: var(--text-secondary);
    transition: all 0.25s ease;
}

.back-link:hover {
    color: var(--primary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-soft);
}

/* ================= CARD BASE ================= */
.settings-card,
.logs-section {
    background: var(--card-bg);
    backdrop-filter: blur(14px);
    border-radius: var(--radius-lg);
    padding: 32px;
    box-shadow: var(--shadow-soft);
    border: 1px solid var(--border-soft);
    margin-bottom: 32px;
    transition: all 0.3s ease;
}

.settings-card:hover,
.logs-section:hover {
    box-shadow: var(--shadow-hover);
}

/* ================= CARD TITLES ================= */
.settings-card h2,
.logs-section h2 {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 24px;
    color: var(--text-primary);
}

/* ================= FORM ================= */
.form-group {
    margin-bottom: 24px;
}

.form-group label {
    font-weight: 600;
    font-size: 14px;
    color: var(--text-primary);
}

/* Inputs */
.form-group input,
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 14px 16px;
    border-radius: var(--radius-md);
    border: 1px solid var(--border-soft);
    background: #ffffff;
    font-size: 15px;
    transition: all 0.25s ease;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px var(--primary-soft);
}

.form-group textarea {
    min-height: 110px;
    resize: vertical;
}

.form-help {
    font-size: 13px;
    margin-top: 6px;
    color: var(--text-secondary);
}

/* ================= TOGGLE ================= */
.toggle-switch {
    width: 56px;
    height: 30px;
    position: relative;
}

.toggle-slider {
    background: #cbd5e1;
    border-radius: 30px;
    transition: all 0.3s ease;
}

.toggle-slider:before {
    width: 22px;
    height: 22px;
}

input:checked + .toggle-slider {
    background: linear-gradient(135deg, var(--primary), #6366f1);
}

/* ================= SAVE BUTTON ================= */
button.btn {
    background: linear-gradient(135deg, var(--primary), #6366f1);
    border-radius: var(--radius-md);
    font-weight: 700;
    letter-spacing: 0.3px;
    transition: all 0.3s ease;
}

button.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(124, 58, 237, 0.35);
}

/* ================= LOGS ================= */
.log-item {
    padding: 18px 0;
    display: flex;
    gap: 16px;
    border-bottom: 1px dashed var(--border-soft);
}

.log-type {
    background: var(--primary-soft);
    color: var(--primary);
}

.log-status.success {
    background: #dcfce7;
    color: #166534;
}

.log-status.failed {
    background: #fee2e2;
    color: #991b1b;
}

/* ================= EMPTY STATE ================= */
.logs-section p {
    font-size: 14px;
}
.settings-card {
    background:
        linear-gradient(
            180deg,
            rgba(124, 58, 237, 0.04),
            rgba(255, 255, 255, 0.9) 35%
        ),
        var(--card-bg);
}

/* Section divider feel */
.form-group {
    background: rgba(255, 255, 255, 0.85);
    border: 1px solid rgba(0, 0, 0, 0.04);
    border-radius: 16px;
    padding: 18px 18px 16px;
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
    transition: all 0.25s ease;
}

/* Hover lift for form blocks */
.form-group:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
}

/* Labels stronger + icon spacing */
.form-group label {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 14px;
    font-weight: 700;
    color: #0f172a;
    margin-bottom: 10px;
}

/* Inputs ‚Äì glass + depth */
.form-group input,
.form-group select,
.form-group textarea {
    background: linear-gradient(
        180deg,
        #ffffff,
        #f8fafc
    );
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 14px;
    padding: 14px 16px;
    font-size: 15px;
    box-shadow:
        inset 0 1px 2px rgba(0,0,0,0.04),
        0 1px 0 rgba(255,255,255,0.7);
}

/* Focus = premium glow */
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    background: #ffffff;
    border-color: var(--primary);
    box-shadow:
        0 0 0 4px rgba(124, 58, 237, 0.18),
        inset 0 1px 2px rgba(0,0,0,0.04);
}

/* Placeholder polish */
.form-group input::placeholder,
.form-group textarea::placeholder {
    color: #94a3b8;
}

/* Help text ‚Äì softer card feel */
.form-help {
    background: rgba(124, 58, 237, 0.06);
    border-radius: 10px;
    padding: 8px 12px;
    margin-top: 10px;
    font-size: 12.5px;
    color: #475569;
}

/* ================= TOGGLE UPGRADE ================= */
.toggle-switch {
    filter: drop-shadow(0 3px 6px rgba(0,0,0,0.12));
}

.toggle-slider {
    background: linear-gradient(135deg, #cbd5e1, #e2e8f0);
}

input:checked + .toggle-slider {
    background: linear-gradient(
        135deg,
        #7c3aed,
        #6366f1
    );
}

/* ================= SAVE BUTTON ‚Äì HERO ================= */
button.btn {
    margin-top: 10px;
    height: 52px;
    font-size: 16px;
    letter-spacing: 0.4px;
    background: linear-gradient(
        135deg,
        #7c3aed,
        #6366f1
    );
    box-shadow:
        0 10px 30px rgba(124, 58, 237, 0.35),
        inset 0 1px 0 rgba(255,255,255,0.35);
}

button.btn:hover {
    transform: translateY(-3px);
    box-shadow:
        0 18px 45px rgba(124, 58, 237, 0.45);
}

/* ================= MOBILE REFINEMENT ================= */
@media (max-width: 768px) {
    .form-group {
        padding: 16px;
    }
}

/* ================= RESPONSIVE ================= */
@media (max-width: 768px) {
    .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 14px;
    }

    .settings-card,
    .logs-section {
        padding: 24px;
    }
}

@media (max-width: 480px) {
    .page-header h1 {
        font-size: 24px;
    }

    .log-item {
        flex-direction: column;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="auto-comment-container">
    <div class="page-header">
        <h1>üí≠ Auto-Comment Reply Settings</h1>
        <a href="{{ url_for('automation.dashboard') }}" class="back-link">‚Üê Back to Automations</a>
    </div>

    <div class="settings-card">
        <h2>‚öôÔ∏è Configuration</h2>
        <form method="POST" action="{{ url_for('automation.update_auto_comment_settings') }}">
            <div class="form-group">
                <label style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Enable Auto-Reply to Comments</span>
                    <label class="toggle-switch">
                        <input type="checkbox" name="is_active" {{ 'checked' if settings.is_active else '' }}>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <p class="form-help">When enabled, the system will automatically reply to comments on your posts.</p>
            </div>

            <div class="form-group">
                <label>Reply Tone</label>
                <select name="tone">
                    <option value="friendly" {{ 'selected' if settings.tone == 'friendly' else '' }}>Friendly & Warm</option>
                    <option value="professional" {{ 'selected' if settings.tone == 'professional' else '' }}>Professional</option>
                    <option value="casual" {{ 'selected' if settings.tone == 'casual' else '' }}>Casual & Fun</option>
                    <option value="enthusiastic" {{ 'selected' if settings.tone == 'enthusiastic' else '' }}>Enthusiastic</option>
                </select>
                <p class="form-help">The tone used when generating replies.</p>
            </div>

            <div class="form-group">
                <label>Reply Delay (seconds)</label>
                <input type="number" name="delay_seconds" value="{{ settings.delay_seconds }}" min="0" max="300">
                <p class="form-help">Delay before replying to make responses appear more human. 0 = instant reply.</p>
            </div>

            <div class="form-group">
                <label style="display: flex; justify-content: space-between; align-items: center;">
                    <span>Use RAG for Context-Aware Replies</span>
                    <label class="toggle-switch">
                        <input type="checkbox" name="use_rag" {{ 'checked' if settings.use_rag else '' }}>
                        <span class="toggle-slider"></span>
                    </label>
                </label>
                <p class="form-help">When enabled, replies will be generated using your RAG knowledge base for better context.</p>
            </div>

            <div class="form-group">
                <label>Fallback Message</label>
                <textarea name="fallback_message" placeholder="Used when RAG fails or is disabled">{{ settings.fallback_message }}</textarea>
                <p class="form-help">This message is used when the AI system is unavailable.</p>
            </div>

            <div class="form-group">
                <label>Max Replies Per Hour</label>
                <input type="number" name="max_replies_per_hour" value="{{ settings.max_replies_per_hour }}" min="1" max="100">
                <p class="form-help">Rate limit to prevent spam. Set higher for popular accounts.</p>
            </div>

            <div class="form-group">
                <label>Ignore Keywords (comma-separated)</label>
                <input type="text" name="ignore_keywords" value="{% if settings.ignore_keywords %}{{ settings.ignore_keywords|from_json|join(', ') }}{% endif %}" placeholder="spam, bot, ignore">
                <p class="form-help">Comments containing these keywords will be ignored.</p>
            </div>

            <button type="submit" class="btn" style="background: #561098; color: white; padding: 12px 30px; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; font-size: 16px; width: 100%;">
                üíæ Save Settings
            </button>
        </form>
    </div>

    <div class="logs-section">
        <h2 style="margin: 0 0 20px 0; font-size: 20px; font-weight: 700;">Recent Activity</h2>
        {% if recent_logs %}
            {% for log in recent_logs %}
            <div class="log-item">
                <div class="log-content">
                    <div style="display: flex; gap: 10px; margin-bottom: 8px;">
                        <span class="log-type">{{ log.automation_type }}</span>
                        <span class="log-status {{ 'success' if log.success else 'failed' }}">
                            {{ 'Success' if log.success else 'Failed' }}
                        </span>
                    </div>
                    <p style="margin: 0 0 5px 0; color: #1f2937; font-size: 14px;">
                        <strong>Action:</strong> {{ log.action_taken or 'N/A' }}
                    </p>
                    {% if log.response_text %}
                    <p style="margin: 0; color: #6b7280; font-size: 13px;">
                        <strong>Reply:</strong> {{ log.response_text[:100] }}{% if log.response_text|length > 100 %}...{% endif %}
                    </p>
                    {% endif %}
                    {% if log.error_message %}
                    <p style="margin: 5px 0 0 0; color: #dc2626; font-size: 13px;">
                        <strong>Error:</strong> {{ log.error_message }}
                    </p>
                    {% endif %}
                </div>
                <div style="text-align: right; color: #9ca3af; font-size: 12px;">
                    {{ log.created_at.strftime('%b %d, %H:%M') }}
                </div>
            </div>
            {% endfor %}
        {% else %}
            <p style="text-align: center; color: #9ca3af; padding: 40px 0;">
                No activity yet. Enable auto-reply to start seeing logs here.
            </p>
        {% endif %}
    </div>
</div>
{% endblock %}
