<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status Monitor - PostScheduler</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin-warning {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .animate-spin-warning {
            animation: spin-warning 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    
    <!-- Navigation Bar -->
    <nav class="bg-slate-900/80 backdrop-blur-lg border-b border-white/10 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-white">System Status Monitor</h1>
                    <span class="text-slate-400 text-sm">Real-time Architecture Dashboard</span>
                </div>
                <div class="flex gap-3">
                    <a href="/" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                        ‚Üê Dashboard
                    </a>
                    <a href="{{ url_for('rag.status') }}" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors">
                        üß† RAG Status
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div id="root"></div>
    
    <!-- React Component -->
    {% raw %}
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const SystemStatusDashboard = ({ systemState = {}, onRefresh, isRefreshing }) => {
            const parseSystemState = () => {
                return {
                    instaGraphApi: systemState?.instaGraphApi || { status: 'operational', latency: '142ms', rateLimitRemaining: '87%' },
                    webhooksConfig: systemState?.webhooksConfig || { status: 'operational', activeHooks: 3, lastEvent: '2m ago' },
                    sqlDatabase: systemState?.sqlDatabase || { status: 'operational', activeConnections: 12, latency: '8ms' },
                    groqCloud: systemState?.groqCloud || { status: 'operational', model: 'llama-3.1-70b', latency: '234ms' },
                    pinecone: systemState?.pinecone || { status: 'operational', index: 'social-vectors', totalVectors: '12,847', latency: '45ms' },
                    scheduler: systemState?.scheduler || { status: 'operational', jobsQueued: 7, nextRun: '15m' },
                    automation: systemState?.automation || { status: 'operational', lastTriggered: '5m ago', successRate: '94%' },
                    geminiApi: systemState?.geminiApi || { status: 'operational', latency: '189ms', quotaUsedToday: '23%' },
                    llumaAi: systemState?.llumaAi || { status: 'operational', latency: '156ms', modelVersion: 'v2.3.1' }
                };
            };
            
            const services = parseSystemState();
            
            const StatusIndicator = ({ status }) => {
                const styles = {
                    operational: 'bg-emerald-500 animate-pulse shadow-lg shadow-emerald-500/50',
                    degraded: 'bg-yellow-500 animate-spin-warning shadow-lg shadow-yellow-500/50',
                    down: 'bg-red-500 shadow-lg shadow-red-500/50'
                };
                
                return (
                    <div className="relative inline-flex items-center justify-center w-3 h-3">
                        <div className={`w-2 h-2 rounded-full ${styles[status] || styles.operational}`}></div>
                    </div>
                );
            };
            
            const ServiceCard = ({ title, status, icon, details, glowColor }) => (
                <div className="relative group">
                    <div className={`absolute inset-0 bg-gradient-to-br ${glowColor} rounded-xl blur-xl opacity-20 group-hover:opacity-40 transition-opacity`}></div>
                    <div className="relative bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-xl p-5 shadow-2xl hover:scale-[1.02] transition-all duration-300">
                        <div className="flex items-start gap-3">
                            <div className="text-3xl">{icon}</div>
                            <div className="flex-1">
                                <div className="flex items-center gap-2 mb-3">
                                    <StatusIndicator status={status} />
                                    <h3 className="text-white font-semibold text-base">{title}</h3>
                                </div>
                                <div className="space-y-1.5">
                                    {details.map((detail, idx) => (
                                        <p key={idx} className="text-sm text-slate-300/90 font-mono">{detail}</p>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
            
            return (
                <div className="container mx-auto px-6 py-8 max-w-7xl">
                    
                    {/* Header Section */}
                    <div className="bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-xl p-6 mb-8 shadow-2xl">
                        <div className="flex items-center justify-between mb-4">
                            <div className="flex items-center gap-4">
                                <div className="bg-gradient-to-r from-emerald-500 to-blue-500 p-3 rounded-lg">
                                    <span className="text-white text-2xl">‚ö°</span>
                                </div>
                                <div>
                                    <h2 className="text-2xl font-bold text-white">System Architecture Monitor</h2>
                                    <p className="text-slate-400 text-sm">Real-time monitoring of all 9 critical services</p>
                                </div>
                            </div>
                            <button 
                                onClick={onRefresh}
                                disabled={isRefreshing}
                                className="px-6 py-3 bg-gradient-to-r from-emerald-500 to-blue-500 hover:from-emerald-600 hover:to-blue-600 text-white font-semibold rounded-lg shadow-lg transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                <span className={isRefreshing ? 'animate-spin' : ''}>üîÑ</span>
                                {isRefreshing ? 'Refreshing...' : 'Refresh Status'}
                            </button>
                        </div>
                        <div className="flex gap-6 text-sm">
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded-full bg-emerald-500 animate-pulse"></div>
                                <span className="text-slate-300">Operational</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                <span className="text-slate-300">Degraded</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                <span className="text-slate-300">Down</span>
                            </div>
                        </div>
                    </div>
                    
                    {/* Database Cluster */}
                    <div className="mb-8">
                        <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span className="w-2 h-2 rounded-full bg-blue-500"></span>
                            Database Cluster
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <ServiceCard 
                                title="SQL Database" 
                                status={services.sqlDatabase.status} 
                                icon="üóÑÔ∏è" 
                                details={[`Connections: ${services.sqlDatabase.activeConnections}`, `Latency: ${services.sqlDatabase.latency}`, `Status: ${services.sqlDatabase.status}`]} 
                                glowColor="from-blue-500 to-cyan-500" 
                            />
                            <ServiceCard 
                                title="Pinecone Vector DB" 
                                status={services.pinecone.status} 
                                icon="üî∑" 
                                details={[`Index: ${services.pinecone.index}`, `Vectors: ${services.pinecone.totalVectors}`, `Latency: ${services.pinecone.latency}`]} 
                                glowColor="from-purple-500 to-pink-500" 
                            />
                            <ServiceCard 
                                title="Webhooks Config" 
                                status={services.webhooksConfig.status} 
                                icon="üîó" 
                                details={[`Active Hooks: ${services.webhooksConfig.activeHooks}`, `Last Event: ${services.webhooksConfig.lastEvent}`, `Status: ${services.webhooksConfig.status}`]} 
                                glowColor="from-emerald-500 to-teal-500" 
                            />
                        </div>
                    </div>
                    
                    {/* AI Services */}
                    <div className="mb-8">
                        <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span className="w-2 h-2 rounded-full bg-orange-500"></span>
                            AI Services
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <ServiceCard 
                                title="Groq Cloud API" 
                                status={services.groqCloud.status} 
                                icon="üß†" 
                                details={[`Model: ${services.groqCloud.model}`, `Latency: ${services.groqCloud.latency}`, `Status: ${services.groqCloud.status}`]} 
                                glowColor="from-orange-500 to-red-500" 
                            />
                            <ServiceCard 
                                title="Gemini API" 
                                status={services.geminiApi.status} 
                                icon="‚ú®" 
                                details={[`Latency: ${services.geminiApi.latency}`, `Quota Used: ${services.geminiApi.quotaUsedToday}`, `Status: ${services.geminiApi.status}`]} 
                                glowColor="from-blue-500 to-indigo-500" 
                            />
                            <ServiceCard 
                                title="Lluma AI API" 
                                status={services.llumaAi.status} 
                                icon="ü§ñ" 
                                details={[`Latency: ${services.llumaAi.latency}`, `Version: ${services.llumaAi.modelVersion}`, `Status: ${services.llumaAi.status}`]} 
                                glowColor="from-violet-500 to-purple-500" 
                            />
                        </div>
                    </div>
                    
                    {/* Workflows & APIs */}
                    <div className="mb-8">
                        <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
                            <span className="w-2 h-2 rounded-full bg-pink-500"></span>
                            Workflows & APIs
                        </h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <ServiceCard 
                                title="Instagram Graph API" 
                                status={services.instaGraphApi.status} 
                                icon="üì±" 
                                details={[`Latency: ${services.instaGraphApi.latency}`, `Rate Limit: ${services.instaGraphApi.rateLimitRemaining}`, `Status: ${services.instaGraphApi.status}`]} 
                                glowColor="from-pink-500 to-rose-500" 
                            />
                            <ServiceCard 
                                title="Scheduler Workflow" 
                                status={services.scheduler.status} 
                                icon="‚è∞" 
                                details={[`Jobs Queued: ${services.scheduler.jobsQueued}`, `Next Run: ${services.scheduler.nextRun}`, `Status: ${services.scheduler.status}`]} 
                                glowColor="from-yellow-500 to-amber-500" 
                            />
                            <ServiceCard 
                                title="Automation Workflow" 
                                status={services.automation.status} 
                                icon="‚ö°" 
                                details={[`Last Triggered: ${services.automation.lastTriggered}`, `Success Rate: ${services.automation.successRate}`, `Status: ${services.automation.status}`]} 
                                glowColor="from-cyan-500 to-blue-500" 
                            />
                        </div>
                    </div>
                </div>
            );
        };
        
        function App() {
            const [systemState, setSystemState] = useState({});
            const [isRefreshing, setIsRefreshing] = useState(false);
            
            const fetchStatus = async () => {
                setIsRefreshing(true);
                try {
                    const response = await fetch('/api/status/system');
                    const data = await response.json();
                    setSystemState(data);
                } catch (error) {
                    console.error('Error fetching system status:', error);
                    // Don't update state on error to prevent re-renders
                } finally {
                    setIsRefreshing(false);
                }
            };
            
            // Only fetch once on mount, no auto-refresh
            useEffect(() => {
                // fetchStatus(); // Removed to prevent initial API call
            }, []);
            
            return <SystemStatusDashboard systemState={systemState} onRefresh={fetchStatus} isRefreshing={isRefreshing} />;
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    {% endraw %}
    
</body>
</html>
