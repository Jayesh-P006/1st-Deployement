<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced System Status - PostScheduler</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React and ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            overflow-x: hidden;
        }
        
        @keyframes pulse-glow {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        @keyframes spin-warning {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-pulse-glow {
            animation: pulse-glow 2s ease-in-out infinite;
        }
        
        .animate-spin-warning {
            animation: spin-warning 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen">
    
    <!-- Navigation Bar -->
    <nav class="bg-slate-900/80 backdrop-blur-lg border-b border-white/10 sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <h1 class="text-2xl font-bold text-white">System Status</h1>
                    <span class="text-slate-400 text-sm">Real-time Architecture Monitor</span>
                </div>
                <div class="flex gap-3">
                    <a href="/" class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-lg transition-colors">
                        ‚Üê Dashboard
                    </a>
                    <a href="{{ url_for('rag.status') }}" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg transition-colors">
                        üß† RAG Status
                    </a>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div id="root"></div>
    
    <!-- React Component -->
    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        
        const AdvancedSystemStatusWidget = ({ systemState = {} }) => {
            const [isMinimized, setIsMinimized] = useState(false);
            const [position, setPosition] = useState({ x: window.innerWidth - 900, y: 100 });
            const [isDragging, setIsDragging] = useState(false);
            const [dragOffset, setDragOffset] = useState({ x: 0, y: 0 });
            const widgetRef = useRef(null);
            
            const parseSystemState = () => {
                return {
                    instaGraphApi: systemState?.instaGraphApi || { status: 'operational', latency: '142ms', rateLimitRemaining: '87%' },
                    webhooksConfig: systemState?.webhooksConfig || { status: 'operational', activeHooks: 3, lastEvent: '2m ago' },
                    sqlDatabase: systemState?.sqlDatabase || { status: 'operational', activeConnections: 12, latency: '8ms' },
                    groqCloud: systemState?.groqCloud || { status: 'operational', model: 'llama-3.1-70b', latency: '234ms' },
                    pinecone: systemState?.pinecone || { status: 'operational', index: 'social-vectors', totalVectors: '12,847', latency: '45ms' },
                    scheduler: systemState?.scheduler || { status: 'operational', jobsQueued: 7, nextRun: '15m' },
                    automation: systemState?.automation || { status: 'operational', lastTriggered: '5m ago', successRate: '94%' },
                    geminiApi: systemState?.geminiApi || { status: 'operational', latency: '189ms', quotaUsedToday: '23%' },
                    llumaAi: systemState?.llumaAi || { status: 'operational', latency: '156ms', modelVersion: 'v2.3.1' }
                };
            };
            
            const services = parseSystemState();
            
            useEffect(() => {
                const handleMouseMove = (e) => {
                    if (isDragging) {
                        setPosition({ x: e.clientX - dragOffset.x, y: e.clientY - dragOffset.y });
                    }
                };
                
                const handleMouseUp = () => setIsDragging(false);
                
                if (isDragging) {
                    document.addEventListener('mousemove', handleMouseMove);
                    document.addEventListener('mouseup', handleMouseUp);
                }
                
                return () => {
                    document.removeEventListener('mousemove', handleMouseMove);
                    document.removeEventListener('mouseup', handleMouseUp);
                };
            }, [isDragging, dragOffset]);
            
            const handleMouseDown = (e) => {
                if (e.target.closest('.drag-handle')) {
                    const rect = widgetRef.current.getBoundingClientRect();
                    setDragOffset({ x: e.clientX - rect.left, y: e.clientY - rect.top });
                    setIsDragging(true);
                }
            };
            
            const StatusIndicator = ({ status }) => {
                const styles = {
                    operational: 'bg-emerald-500 animate-pulse shadow-lg shadow-emerald-500/50',
                    degraded: 'bg-yellow-500 animate-spin-warning shadow-lg shadow-yellow-500/50',
                    down: 'bg-red-500 shadow-lg shadow-red-500/50'
                };
                
                return (
                    <div className="relative inline-flex items-center justify-center w-3 h-3">
                        <div className={`w-2 h-2 rounded-full ${styles[status] || styles.operational}`}></div>
                    </div>
                );
            };
            
            const ServiceNode = ({ title, status, icon, details, position, glowColor }) => (
                <div className={`absolute ${position} transform transition-all duration-300 hover:scale-105`} style={{ zIndex: 10 }}>
                    <div className="relative group">
                        <div className={`absolute inset-0 bg-gradient-to-br ${glowColor} rounded-xl blur-xl opacity-30 group-hover:opacity-50 transition-opacity`}></div>
                        <div className="relative bg-slate-900/60 backdrop-blur-xl border border-white/10 rounded-xl p-4 min-w-[220px] shadow-2xl">
                            <div className="flex items-start gap-3">
                                <div className="text-2xl mt-1">{icon}</div>
                                <div className="flex-1">
                                    <div className="flex items-center gap-2 mb-2">
                                        <StatusIndicator status={status} />
                                        <h3 className="text-white font-semibold text-sm">{title}</h3>
                                    </div>
                                    <div className="space-y-1">
                                        {details.map((detail, idx) => (
                                            <p key={idx} className="text-xs text-slate-300/80 font-mono">{detail}</p>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
            
            if (isMinimized) {
                return (
                    <div ref={widgetRef} style={{ position: 'fixed', left: `${position.x}px`, top: `${position.y}px`, zIndex: 9999 }} onMouseDown={handleMouseDown} className="drag-handle cursor-move">
                        <div onClick={() => setIsMinimized(false)} className="relative w-16 h-16 bg-gradient-to-br from-purple-600 to-blue-600 rounded-full shadow-2xl cursor-pointer hover:scale-110 transition-transform">
                            <div className="absolute inset-0 bg-gradient-to-br from-purple-500 to-blue-500 rounded-full animate-pulse opacity-50"></div>
                            <div className="absolute inset-0 flex items-center justify-center text-white text-2xl">‚ö°</div>
                        </div>
                    </div>
                );
            }
            
            return (
                <div ref={widgetRef} style={{ position: 'fixed', left: `${position.x}px`, top: `${position.y}px`, zIndex: 9999, width: '850px', height: '700px' }} onMouseDown={handleMouseDown}>
                    <div className="relative w-full h-full bg-gradient-to-br from-slate-900/80 via-purple-900/60 to-slate-900/80 backdrop-blur-2xl border border-white/20 rounded-2xl shadow-2xl overflow-hidden">
                        <div className="drag-handle relative z-20 flex items-center justify-between px-6 py-4 bg-slate-900/40 backdrop-blur-sm border-b border-white/10 cursor-move">
                            <div className="flex items-center gap-3">
                                <div className="relative bg-gradient-to-r from-emerald-500 to-blue-500 p-2 rounded-lg">
                                    <span className="text-white text-xl">‚ö°</span>
                                </div>
                                <div>
                                    <h2 className="text-white font-bold text-lg">System Architecture Monitor</h2>
                                    <p className="text-slate-400 text-xs">Real-time network visualization</p>
                                </div>
                            </div>
                            <button onClick={() => setIsMinimized(true)} className="p-2 hover:bg-white/10 rounded-lg transition-colors text-white">‚Äî</button>
                        </div>
                        
                        <div className="relative h-[calc(100%-76px)] p-8 overflow-hidden">
                            <ServiceNode title="SQL Database" status={services.sqlDatabase.status} icon="üóÑÔ∏è" details={[`Connections: ${services.sqlDatabase.activeConnections}`, `Latency: ${services.sqlDatabase.latency}`]} position="top-[20px] left-[20px]" glowColor="from-blue-500 to-cyan-500" />
                            <ServiceNode title="Pinecone Status" status={services.pinecone.status} icon="üî∑" details={[`Index: ${services.pinecone.index}`, `Vectors: ${services.pinecone.totalVectors}`]} position="top-[140px] left-[20px]" glowColor="from-purple-500 to-pink-500" />
                            <ServiceNode title="Webhooks Config" status={services.webhooksConfig.status} icon="üîó" details={[`Active: ${services.webhooksConfig.activeHooks}`, `Last: ${services.webhooksConfig.lastEvent}`]} position="top-[260px] left-[20px]" glowColor="from-emerald-500 to-teal-500" />
                            <ServiceNode title="Groq Cloud" status={services.groqCloud.status} icon="üß†" details={[`Model: ${services.groqCloud.model}`, `Latency: ${services.groqCloud.latency}`]} position="top-[20px] left-[280px]" glowColor="from-orange-500 to-red-500" />
                            <ServiceNode title="Gemini API" status={services.geminiApi.status} icon="‚ú®" details={[`Latency: ${services.geminiApi.latency}`, `Quota: ${services.geminiApi.quotaUsedToday}`]} position="top-[140px] left-[280px]" glowColor="from-blue-500 to-indigo-500" />
                            <ServiceNode title="Lluma AI" status={services.llumaAi.status} icon="ü§ñ" details={[`Latency: ${services.llumaAi.latency}`, `Ver: ${services.llumaAi.modelVersion}`]} position="top-[260px] left-[280px]" glowColor="from-violet-500 to-purple-500" />
                            <ServiceNode title="Instagram API" status={services.instaGraphApi.status} icon="üì±" details={[`Latency: ${services.instaGraphApi.latency}`, `Rate: ${services.instaGraphApi.rateLimitRemaining}`]} position="top-[20px] left-[540px]" glowColor="from-pink-500 to-rose-500" />
                            <ServiceNode title="Scheduler" status={services.scheduler.status} icon="‚è∞" details={[`Jobs: ${services.scheduler.jobsQueued}`, `Next: ${services.scheduler.nextRun}`]} position="top-[140px] left-[540px]" glowColor="from-yellow-500 to-amber-500" />
                            <ServiceNode title="Automation" status={services.automation.status} icon="‚ö°" details={[`Last: ${services.automation.lastTriggered}`, `Success: ${services.automation.successRate}`]} position="top-[340px] left-[540px]" glowColor="from-cyan-500 to-blue-500" />
                        </div>
                    </div>
                </div>
            );
        };
        
        function App() {
            const [systemState, setSystemState] = useState({});
            
            useEffect(() => {
                const fetchStatus = async () => {
                    try {
                        const response = await fetch('/api/status/system');
                        const data = await response.json();
                        setSystemState(data);
                    } catch (error) {
                        console.log('Using mock data');
                    }
                };
                
                fetchStatus();
                const interval = setInterval(fetchStatus, 30000);
                return () => clearInterval(interval);
            }, []);
            
            return (
                <div className="min-h-screen p-8">
                    <div className="container mx-auto max-w-7xl">
                        <div className="grid grid-cols-3 gap-6 mb-8">
                            {[
                                { title: 'Posts Scheduled', value: '47', icon: 'üìÖ' },
                                { title: 'Active Workflows', value: '12', icon: '‚ö°' },
                                { title: 'AI Generations', value: '234', icon: 'üß†' }
                            ].map((stat, i) => (
                                <div key={i} className="bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-6 hover:bg-white/10 transition-all">
                                    <div className="flex items-center justify-between mb-3">
                                        <span className="text-3xl">{stat.icon}</span>
                                        <span className="text-3xl font-bold text-white">{stat.value}</span>
                                    </div>
                                    <h3 className="text-white/80 font-medium text-sm">{stat.title}</h3>
                                </div>
                            ))}
                        </div>
                        
                        <div className="bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-8 mb-8">
                            <h2 className="text-2xl font-bold text-white mb-4">Architecture Overview</h2>
                            <p className="text-slate-300 mb-4">
                                The floating widget (top-right) provides real-time monitoring of all 9 critical services in your social media automation architecture. 
                                Drag it anywhere, minimize it, or hover over nodes for detailed metrics.
                            </p>
                            <div className="flex gap-4 text-sm">
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-emerald-500 animate-pulse"></div>
                                    <span className="text-slate-300">Operational</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-yellow-500"></div>
                                    <span className="text-slate-300">Degraded</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <div className="w-3 h-3 rounded-full bg-red-500"></div>
                                    <span className="text-slate-300">Down</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <AdvancedSystemStatusWidget systemState={systemState} />
                </div>
            );
        }
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
</body>
</html>
